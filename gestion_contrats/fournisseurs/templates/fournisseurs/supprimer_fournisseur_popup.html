<div id="deletePopup" class="popup">
    <div class="popup-content">
        <span class="close" onclick="closeDeletePopup()">&times;</span>
        <div class="popup-body text-center">
            <i class="fa-solid fa-triangle-exclamation warning-icon"></i>
            <h2 class="popup-title">Confirmer la suppression</h2>
            
            <div class="confirmation-message">
                <p>Êtes-vous sûr de vouloir supprimer définitivement :</p>
                <div class="fournisseur-name" id="nomFournisseur"></div>
                <p class="text-muted">Cette action ne peut être annulée</p>
            </div>

            <form id='deleteForm' method="post" class="confirmation-actions">
                {% csrf_token %}
                <input type="hidden" name="_method" value="DELETE">
                <div class="button-group">
                    <button type="button" class="btn btn-neutral" onclick="closeDeletePopup()">
                        Annuler
                    </button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fa-solid fa-trash-can"></i>
                        Supprimer
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    let fournisseurIdToDelete = null;

    function openDeletePopup(fournisseurId) {
    const popup = document.getElementById('deletePopup');
    popup.style.display = 'flex';
    setTimeout(() => {
        popup.classList.add('active');
    }, 10);
        console.log("Ouverture du popup pour fournisseur ID:", fournisseurId);
        fournisseurIdToDelete = fournisseurId;

        // Récupérer le nom du fournisseur via une requête AJAX
        fetch(`/fournisseurs/supprimer/${fournisseurId}/`, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            // Injecter le nom dans le popup
            document.getElementById('nomFournisseur').textContent = data.fournisseur;
            document.getElementById('deletePopup').style.display = 'flex';
        })
        .catch(error => {
            console.error(error);
            alert("Erreur lors du chargement du fournisseur");
        });
    }

    function closeDeletePopup() {
    const popup = document.getElementById('deletePopup');
    popup.classList.remove('active');
    setTimeout(() => {
        popup.style.display = 'none';
    }, 300);
    }   

    document.getElementById('deleteForm').addEventListener('submit', function (event) {
        event.preventDefault();
        if (!fournisseurIdToDelete) return;

        fetch(`/fournisseurs/supprimer/${fournisseurIdToDelete}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'X-Requested-With': 'XMLHttpRequest',
            },
            body: '_method=DELETE',
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.reload();
            } else {
                alert("Erreur lors de la suppression.");
            }
        });
    });
    document.querySelectorAll('.close').forEach(btn => {
    btn.addEventListener('click', () => {
        closePopup(btn.closest('.popup').id);
    });
});
document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
            closePopup(btn.closest('.popup').id);
        }
    });
</script>

